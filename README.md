# StoryBuddy - Interactive Storybook App for Children

This beautiful webapp for children helps create illustrations and stories using either random popular templates or specific keywords input by the user. Built with Next.js (using App Router), React 19, and Tailwind CSS 4.

## Features

- **Kid-Friendly Interface**: Colorful, intuitive design that's easy for children to navigate
- **Enhanced Two-Phase Flow**: 
  - Phase 1: User Settings landing page with beautiful hero section and intuitive personalization controls
  - Phase 2: Mode Selection page with visually stunning template/custom story options
  - Seamless sliding transitions between phases for a cohesive experience
- **Full-Screen Reading Experience**:
  - Every page contains both text and a beautiful illustration for maximum engagement
  - Optimized larger page size for better readability and visual impact
  - Responsive design that works well on various screen sizes
- **Text-to-Speech Narration**: Child-friendly speech controls to read stories aloud
- **Adaptive Typography**: Customizable font sizes, spacing, and styles optimized for reading
- **Persistent Settings**: User preferences saved to localStorage to remember choices between sessions
- **Personalization**: Customize story experiences with age range, gender preferences, and character personality traits 
- **Smooth UI Transitions**: Beautiful sliding animations when navigating between sections for an engaging user experience
- **Story Customization**: Easily customize your generated stories:
  - Story length (short/medium/long)
  - Reading level (easy/moderate/advanced)
- **AI-Powered Story Generation**: Create unique stories from popular templates using OpenAI GPT-4
- **Custom Stories**: Generate personalized stories based on keywords provided by the user
- **AI Illustrations**: Beautiful, child-friendly illustrations generated by DALL-E 3
- **Interactive Experience**: Watch as stories and illustrations are generated in real-time
- **Template Library**: Choose from various story themes like Adventure, Fantasy, Space, and more
- **Keyword Suggestions**: Get inspiration for story creation with suggested keywords
- **Immersive Reading**: Book-like experience with page-turning animations, full-page cover illustrations, speech narration, and typography controls
- **Reliable Image Generation**: Bulletproof image system with localStorage caching, batch processing, and automatic retries
- **Story Saving**: Save favorite stories to read again later
- **My Stories Collection**: Browse, search, and organize your saved stories

## Technology Stack

- **Framework**: Next.js 15.2.1 (App Router)
- **Frontend**: React 19, TypeScript
- **Styling**: Tailwind CSS 4
- **Animation**: Smooth sliding transitions and fading animations for UI elements, React PageFlip for book animations
- **AI Integration**: OpenAI API for story generation and DALL-E for illustrations
- **Storage**: LocalStorage for story saving and image caching (prepared for Supabase integration)
- **API Routes**: Server-side API endpoints for secure AI integration
- **Linting**: ESLint 9

## Getting Started

First, run the development server:

```bash
npm run dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the app.

## Project Structure

```
/app                     # App Router directory
  /components            # Reusable components
    /Navigation.tsx      # Main navigation component
    /reader/             # Reader components
      /Page.tsx          # Individual book page component
      /CoverPage.tsx     # Full-page book cover component
      /EnhancedReader.tsx # Immersive reading experience with TTS
    /speech/             # Speech-related components
      /SpeechControls.tsx # Text-to-speech control panel
    /animations/         # Animation components
      /FloatingElement.tsx # Floating animation component
      /TextReveal.tsx    # Animated text reveal component
      /BackgroundShapes.tsx # Dynamic background shapes
    /ui/                 # Core UI components
      /HeroHeading.tsx   # Animated hero section headings
      /FeatureCard.tsx   # Feature highlight cards
      /SelectionCard.tsx # Interactive selection cards
  /context               # React Context providers
    /TypographyContext.tsx # Font and typography settings
  /api                   # API routes for AI integration
    /generate-story      # OpenAI GPT-4 story generation endpoint
    /generate-image      # DALL-E 3 image generation endpoint
  /stories               # Story features
    /templates           # Template-based story generation
    /create              # Keyword-based story creation
    /generate            # Template story generation process
    /display             # Custom story display with illustrations
    /my-stories          # Collection of saved stories
  /types                 # TypeScript type definitions
    /story.ts            # Story-related types
    /ui.ts               # UI component prop types
    /index.ts            # Central export for types
  /utils                 # Utility functions
    /api.ts              # API client functions (legacy)
    /storage.ts          # Story storage and retrieval (legacy)
  /fonts.ts              # Font definitions and optimization
    /prompts/            # Prompt generation utilities
      /storyPrompts.ts   # Story prompt generators
      /imagePrompts.ts   # Image prompt enhancers
    /templates/          # Template management
      /templateData.ts   # Template definitions
      /templateUtils.ts  # Helper functions
  /services              # Service layer
    /storyService.ts     # Story generation service
    /imageService.ts     # Image generation service
    /imageManagementService.ts # Advanced image management with caching
    /storageService.ts   # Local storage service
    /speechService.ts    # Text-to-speech service
  /page.tsx              # Homepage with personalization
/public                  # Static assets
  /paper-texture.png     # Paper texture for book pages
```

## Code Organization

The codebase has been modularized for better maintainability:

1. **Types Module** - Central place for type definitions:
   - `StoryData`, `StoryTheme`, `StoryMode`, etc.
   - UI component props types (`PageProps`, `SpeechControlsProps`, etc.)
   - Improves type safety across the application

2. **Context Providers** - State management:
   - Typography settings with persistent preferences
   - Theming and appearance settings
   - Common shared state

3. **Component Library** - Modular UI building blocks:
   - Reader components (Page, CoverPage, EnhancedReader)
   - Speech components (SpeechControls)
   - Animation components (FloatingElement, TextReveal)
   - UI components (HeroHeading, FeatureCard, SelectionCard)

4. **Prompts Module** - Handles AI prompt generation:
   - Parameterized story prompt generation
   - Image prompt enhancement
   - System prompts for consistent AI outputs

5. **Templates Module** - Manages story templates:
   - Template definitions and metadata
   - Theme mapping for UI consistency
   - Helper functions for template operations

6. **Services Layer** - Business logic encapsulation:
   - Story generation services
   - Image generation with fallbacks and caching
   - Local storage operations
   - Speech synthesis service

## Design Principles

- **Accessibility**: Making the app accessible to all children
- **Child Safety**: Ensuring all content is appropriate for children
- **Personalization**: Adapting content to child's age, preferences and interests
- **Enhanced Reading Experience**: Optimized typography, speech narration, and UI for children
- **Simplicity**: Keeping the interface simple and intuitive with large touch targets
- **Responsiveness**: Works well on tablets and desktop devices
- **Performance**: Fast loading and smooth interactions
- **Reliability**: Robust image handling with fallbacks and caching

## Development Guidelines

- Always use the App Router (not Pages Router)
- Keep components small and focused on a single responsibility
- Use TypeScript types/interfaces for all components and functions
- Follow accessibility best practices
- Add helpful comments to explain complex logic
- Use Tailwind utility classes for styling
- Handle client-side features with "use client" directive

## Personalization

StoryBuddy implements a comprehensive personalization system:

- **Age Range Settings**: Content is tailored to specific developmental stages (3-5, 6-8, 9-12, teenager)
- **Character Customization**: Gender preferences (boy, girl) for story protagonists
- **Personality Traits**: Character personalities that match the child's interests and values
- **Theme Preferences**: UI themes and color schemes to match individual preferences
- **Typography Preferences**: Font family, size, line height, and letter spacing options
- **Reading Preferences**: Reading mode (standard or immersive) and speech narration options 
- **Voice Settings**: Voice selection and reading speed for text-to-speech narration

## Advanced Prompt Engineering

StoryBuddy implements a sophisticated token-aware prompt management system:

- **Token-Optimized Prompts**: Automatically manages token budgets for efficient API usage
- **Modular Prompt Architecture**: Component-based prompt construction for easier maintenance
- **Priority-Based Inclusion**: Intelligently includes or truncates content based on importance
- **Template Variables**: Supports dynamic content injection via variable placeholders
- **Token Counting**: Accurately counts tokens using OpenAI's tiktoken library
- **Separate System/User Content**: Properly manages role-based message structure
- **Automatic Truncation**: Smartly truncates content to fit within token limits while preserving critical information
- **Token Usage Analytics**: Provides detailed token usage metrics for optimization

## Story-Image Integration System

StoryBuddy uses a sophisticated narrative-aware image generation system:

- **Narrative Analysis Engine**: Analyzes story structure to identify key visual moments
- **Page-Specific Illustrations**: Every page is guaranteed to have both text and a relevant illustration
- **Context-Aware Image Prompts**: Images are generated with awareness of the full story context
- **Character Consistency**: Characters maintain consistent appearance throughout illustrations
- **Visual Storytelling**: Illustrations are carefully mapped to narrative progression
- **Safety Optimized**: Image prompts are designed to avoid content policy violations
- **Key Moment Detection**: Automatically identifies the most visually impactful story moments
- **Style Consistency**: Maintains consistent art style across all story illustrations

## Last Updated

- Implemented token-aware prompt management system for optimized API usage - 03/15/2025
- Implemented narrative analysis engine for better story-image integration - 03/15/2025
- Enhanced image prompt generation with story context awareness - 03/15/2025
- Improved image allocation system to guarantee every page has a relevant illustration - 03/15/2025
- Added key moment detection for optimal illustration placement - 03/15/2025
- Enhanced reader experience with larger pages and guaranteed image+text on every page - 03/15/2025
- Added beautiful user interface with detailed progress tracking for image generation - 03/15/2025
- Created theme-specific loading animations with decorative elements - 03/15/2025
- Enhanced image quality with advanced prompt engineering for premium illustrations - 03/15/2025
- Implemented art style definitions with scene composition and lighting guides - 03/15/2025  
- Added sophisticated cover designs with theme-specific elements and interactive parallax effects - 03/15/2025
- Implemented optimized image generation with batching, smart caching, progress events, and robust error recovery - 03/15/2025
- Improved error handling with user-friendly recovery options and intelligent fallbacks - 03/15/2025
- Added text-to-speech narration with child-friendly controls - 03/15/2025 
- Created typography context for enhanced reading experience - 03/15/2025
- Refactored components into modular folders (reader/, speech/, animations/, ui/) - 03/15/2025
- Enhanced page rendering with improved animations and highlighting - 03/15/2025
- Improved type system with UI component prop types - 03/15/2025
- Added theme-based styling for reader components - 03/15/2025
- Modularized codebase for improved maintainability - 03/15/2025
- Added service layer for better business logic organization - 03/15/2025
- Enhanced prompt system for more flexible story generation - 03/15/2025
- Added centralized type definitions - 03/15/2025
- Added customization options for story length and reading level - 03/15/2025
- Enhanced error handling for story generation and image creation - 03/15/2025
- Redesigned user flow with visually stunning hero section and dedicated Mode Selection page - 03/15/2025
- Added persistent state storage to remember user preferences - 03/15/2025
- Added sliding animation for seamless transition between user settings and mode selection - 03/15/2025
- Added personalization features with dynamic themes and character settings - 03/15/2025
- Added immersive reading experience with book-like page turning - 03/15/2025
- Implemented story saving and My Stories collection - 03/15/2025
- Created project with Next.js, React 19, and Tailwind CSS 4 - 03/15/2025
- Added OpenAI integration for story generation with GPT-4 - 03/15/2025
- Added DALL-E 3 integration for illustration generation - 03/15/2025
- Implemented interactive story creation flow with real-time AI generation - 03/15/2025
